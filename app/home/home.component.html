<!-- home.component.html -->
<div class="main-layout">
  <aside class="sidebar">
    <button class="sidebar-icon" title="Dashboard">
      <!-- Dashboard icon -->
      <svg viewBox="0 0 24 24">
        <path
          d="M3 13h8V3H3v10zm10 8h8v-6h-8v6zm0-8h8V3h-8v10zM3 21h8v-6H3v6z"
          fill="currentColor"
        />
      </svg>
    </button>
    <button class="sidebar-icon" title="Vendors">
      <!-- Vendors icon -->
      <svg viewBox="0 0 24 24">
        <path
          d="M16 11c1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3 1.34 3 3 3zm-8 0c1.66 0 3-1.34 3-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V20h14v-3.5C10.33 14.17 6.33 13 8 13zm8 0c-.29 0-.62.02-.97.05C15.53 13.81 17 14.88 17 16.5V20h5v-3.5c0-2.33-4.67-3.5-7-3.5z"
          fill="currentColor"
        />
      </svg>
    </button>
    <button class="sidebar-icon" title="Reports">
      <!-- Reports icon -->
      <svg viewBox="0 0 24 24">
        <path
          d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zm0-8h14V7H7v2z"
          fill="currentColor"
        />
      </svg>
    </button>
    <button class="sidebar-icon" title="Alerts">
      <!-- Alerts icon -->
      <svg viewBox="0 0 24 24">
        <path
          d="M12 22a2 2 0 0 0 2-2H10a2 2 0 0 0 2 2zm6-6V11c0-3.07-1.63-5.64-4.5-6.32V4a1.5 1.5 0 0 0-3 0v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"
          fill="currentColor"
        />
      </svg>
    </button>
    <button class="sidebar-icon" title="Messages">
      <!-- Messages icon -->
      <svg viewBox="0 0 24 24">
        <path
          d="M20 2H4c-1.1 0-2 .9-2 2v16l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"
          fill="currentColor"
        />
      </svg>
    </button>
    <button class="sidebar-icon" title="Calendar">
      <!-- Calendar icon -->
      <svg viewBox="0 0 24 24">
        <path
          d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"
          fill="currentColor"
        />
      </svg>
    </button>
    <button class="sidebar-icon" title="Settings">
      <!-- Settings icon -->
      <svg viewBox="0 0 24 24">
        <path
          d="M19.14 12.936c.036-.303.06-.61.06-.936s-.024-.633-.07-.936l2.03-1.577a.5.5 0 00.12-.638l-1.922-3.32a.5.5 0 00-.605-.22l-2.39.96a7.023 7.023 0 00-1.613-.936l-.36-2.53A.5.5 0 0014.3 2h-4.6a.5.5 0 00-.493.42l-.36 2.53a7.023 7.023 0 00-1.613.936l-2.39-.96a.5.5 0 00-.605.22l-1.922 3.32a.5.5 0 00.12.638l2.03 1.577a6.955 6.955 0 000 1.872l-2.03 1.577a.5.5 0 00-.12.638l1.922 3.32c.132.228.41.32.65.22l2.39-.96c.487.395 1.027.72 1.613.936l.36 2.53a.5.5 0 00.493.42h4.6a.5.5 0 00.493-.42l.36-2.53a7.023 7.023 0 001.613-.936l2.39.96c.24.1.518.008.65-.22l1.922-3.32a.5.5 0 00-.12-.638l-2.03-1.577zM12 15.5a3.5 3.5 0 110-7 3.5 3.5 0 010 7z"
          fill="currentColor"
        />
      </svg>
    </button>
    <button class="sidebar-icon" title="Help">
      <!-- Help icon -->
      <svg viewBox="0 0 24 24">
        <path
          d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-.25-3h1.5v-1.5h-1.5V17zm1.07-7.75c-.9.19-1.32.56-1.32 1.25v.25h1.5v-.25c0-.3.1-.55.78-.72.75-.18 1.22-.61 1.22-1.25 0-.8-.72-1.5-1.68-1.5-.97 0-1.82.68-1.82 1.82h1.5c0-.18.14-.32.32-.32.23 0 .32.11.32.25-.01.23-.29.32-.82.39z"
          fill="currentColor"
        />
      </svg>
    </button>
    <button class="sidebar-icon" title="Logout">
      <!-- Logout icon -->
      <svg viewBox="0 0 24 24">
        <path
          d="M16 13v-2H7V8l-5 4 5 4v-3zM20 3h-8v2h8v14h-8v2h8c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"
          fill="currentColor"
        />
      </svg>
    </button>
  </aside>

  <div class="content-area">
    <div class="dashboard-container">
      <div class="header">
        <h2>Welcome back, Olivia</h2>
      </div>
      <div class="chart-controls">
        <!-- Download -->
        <div class="chart-controls">
          <!-- Search Icon Button -->
          <button class="chart-button" title="Search">
            <svg viewBox="0 0 24 24">
              <circle
                cx="11"
                cy="11"
                r="7"
                stroke="currentColor"
                stroke-width="2"
                fill="none"
              />
              <line
                x1="16"
                y1="16"
                x2="21"
                y2="21"
                stroke="currentColor"
                stroke-width="2"
              />
            </svg>
          </button>

          <!-- Customize Button -->
          <button class="chart-button labeled" title="Customize">
            <svg viewBox="0 0 24 24">
              <line
                x1="3"
                y1="6"
                x2="21"
                y2="6"
                stroke="currentColor"
                stroke-width="2"
              />
              <line
                x1="3"
                y1="12"
                x2="21"
                y2="12"
                stroke="currentColor"
                stroke-width="2"
              />
              <line
                x1="3"
                y1="18"
                x2="21"
                y2="18"
                stroke="currentColor"
                stroke-width="2"
              />
            </svg>
            <span class="label-text">Customize</span>
          </button>

          <!-- Export Button -->
          <button class="chart-button labeled" title="Export">
            <svg viewBox="0 0 24 24">
              <path
                d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"
                stroke="currentColor"
                stroke-width="2"
                fill="none"
              />
              <polyline
                points="7 10 12 15 17 10"
                stroke="currentColor"
                stroke-width="2"
                fill="none"
              />
              <line
                x1="12"
                y1="15"
                x2="12"
                y2="3"
                stroke="currentColor"
                stroke-width="2"
              />
            </svg>
            <span class="label-text">Export</span>
          </button>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="chart-section">
        <!-- Static Bar Chart -->
        <div class="chart-box">
          <div class="chart-header">
            <h3>Vendor breakdown</h3>
            <p>Keep track of vendors and their security ratings.</p>
          </div>

          <div class="chart-body">
            <div class="chart-label-left">Security Rating</div>
            <div class="y-axis">
              <div *ngFor="let label of yAxisLabels" class="y-label">
                {{ label }}
              </div>
            </div>

            <div class="bar-chart-container">
              <div class="bar" *ngFor="let month of months">
                <div class="segment low"></div>
                <div class="segment medium"></div>
                <div class="segment high"></div>
                <span class="label">{{ month }}</span>
              </div>
            </div>
          </div>

          <div class="chart-footer-button">
            <button class="chart-action-button">
              Show All Vendors
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                <path
                  d="M9 5l7 7-7 7"
                  stroke="#6a5acd"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
          </div>
        </div>

        <!-- Pie Chart -->
        <div class="vendors-monitored-card">
          <div class="vendors-content">
            <div class="card-header">
              <h3>Vendors monitored</h3>
              <p class="subtitle">
                You're using 80% of available spots.
                <span class="trend">
                  <svg
                    class="trend-arrow"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M5 12L12 5L19 12"
                      stroke="#4caf50"
                      stroke-width="2"
                      fill="none"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                  <span class="percent">10%</span>
                </span>
              </p>
            </div>

            <div class="gauge-chart">
              <svg viewBox="0 0 36 36" class="gauge">
                <path class="bg" d="M4.5,18 A13.5,13.5 0 1,1 31.5,18" />
                <path class="value" d="M4.5,18 A13.5,13.5 0 0,1 27,7.5" />
              </svg>
              <div class="center-label">240</div>
            </div>

            <p class="warning-title">Youâ€™ve almost reached your limit</p>
            <p class="description">
              You have used 80% of your available spots. Upgrade plan to monitor
              more vendors.
            </p>

            <button class="upgrade-button">
              Upgrade plan
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                <path
                  d="M9 5l7 7-7 7"
                  stroke="#6a5acd"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
          </div>
        </div>
      </div>
      <!-- Dynamic Team Table -->
      <div class="team-table">
        <span class="h3">Team Members</span>
        <span class="member-count"> {{ data.length }} members</span>

        <table>
          <thead>
            <tr>
              <th>
                <input
                  type="checkbox"
                  [checked]="allSelected"
                  (change)="toggleSelectAll($event)"
                />
              </th>
              <th *ngFor="let col of columns">{{ col.column_name }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of paginatedData">
              <td>
                <input
                  type="checkbox"
                  [checked]="selectedRows.includes(row)"
                  (change)="toggleRowSelection(row, $event)"
                />
              </td>
              <td *ngFor="let col of columns">
                <ng-container [ngSwitch]="col.type">
                  <!-- Name type -->
                  <ng-container *ngSwitchCase="'name'">
                    <div>
                      <strong
                        >{{ row[col.column_key]?.first_name }}
                        {{ row[col.column_key]?.last_name }}</strong
                      >
                      <div class="handle">
                        {{ row[col.column_key]?.handle }}
                      </div>
                    </div>
                  </ng-container>

                  <!-- Status, Role, etc -->
                  <ng-container *ngSwitchCase="'text'">
                    {{ row[col.column_key] }}
                  </ng-container>
                  <ng-container *ngSwitchCase="'status'">
                    <span class="status-hover">
                      {{ row[col.column_key] }}
                    </span>
                  </ng-container>

                  <!-- Progress -->
                  <ng-container *ngSwitchCase="'progress'">
                    <div class="progress-container">
                      <div
                        class="progress-bar"
                        [style.width.%]="row[col.column_key]"
                      ></div>
                      <span>{{ row[col.column_key] }}%</span>
                    </div>
                  </ng-container>

                  <!-- Tags -->
                  <ng-container *ngSwitchCase="'tags'">
                    <span
                      *ngFor="let team of row[col.column_key]"
                      class="tag"
                      [ngStyle]="{
                        color: team.text_color,
                        'background-color': team.background_color
                      }"
                    >
                      {{ team.value }}
                    </span>
                  </ng-container>
                </ng-container>
              </td>
              <td class="action-icons">
                <button class="icon-btn" title="Edit" (click)="onEdit(row)">
                  <svg
                    viewBox="0 0 24 24"
                    width="18"
                    height="18"
                    fill="none"
                    stroke="currentColor"
                  >
                    <path
                      d="M4 21h4l11-11-4-4L4 17v4zM18 2l4 4-4-4z"
                      stroke-width="2"
                    />
                  </svg>
                </button>
                <button class="icon-btn" (click)="deleteRow(row)" title="Delete">
                  <svg
                    viewBox="0 0 24 24"
                    width="18"
                    height="18"
                    fill="none"
                    stroke="currentColor"
                  >
                    <path
                      d="M3 6h18M8 6v14h8V6M10 10v6M14 10v6"
                      stroke-width="2"
                    />
                  </svg>
                </button>
              </td>
            </tr>
          </tbody>
        </table>

        <!-- Pagination -->
        <div class="pagination-controls">
          <button
            (click)="goToPage(currentPage - 1)"
            [disabled]="currentPage === 1"
          >
            Prev
          </button>
          <span>Page {{ currentPage }}</span>
          <button
            (click)="goToPage(currentPage + 1)"
            [disabled]="currentPage * pageSize >= data.length"
          >
            Next
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal-backdrop" *ngIf="selectedRow" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h3>Edit User</h3>
    <p>
      Name: {{ selectedRow.name.first_name }} {{ selectedRow.name.last_name }}
    </p>
    <button (click)="closeModal()">Close</button>
  </div>
</div>
